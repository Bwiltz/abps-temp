import { bus } from 'partybus';
import xAPI from 'tincan';

const useTincan = (config, testing, sections) => {

	bus.on('activity::ready', () => { bus.emit('tincan::start') });

	bus.on('hucklebucked', (slug) => {
	  if (slug !== sections[0].slug) {
	    bus.emit('tincan::bookmark', slug);
	  }
	});

	bus.on('activity::progress::mark_as_completed', () => bus.emit('tincan::complete'));

	bus.on('activity::progress::updated', (sections) => {
		console.log("PROGRESS UPDATED", sections);
		bus.emit('tincan::sections', sections);	
	});

	bus.on('tincan::progress::reset', () => {
		bus.emit('tincan::sections', []);
		bus.emit('tincan::bookmark', null);
		bus.emit('window::reload');
	});

  return xAPI(config, testing.send, testing.url);
};

export default useTincan;